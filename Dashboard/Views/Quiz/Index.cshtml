@model QuizViewModel
@{
    ViewData["Title"] = "Quiz";
}

<div class="container">
    <div class="item">
        <h2>Question @(@Model.CurrentIndex + 1) sur @Model.Total</h2>

        @* Bloc question: si contient ``` on affiche en <pre><code> *@
        @{
            var text = Model.Current.QuestionText ?? "";
            var hasCode = text.Contains("```");
        }
        @if (!hasCode)
        {
            <p>@text</p>
        }
        else
        {
            var start = text.IndexOf("```");
            var end = text.LastIndexOf("```");
            var code = (start >= 0 && end > start) ? text.Substring(start + 3, end - start - 3) : text;
            <pre><code>@code</code></pre>
        }

        @* Choix sous forme d'un seul formulaire POST *@
        @if (!Model.ShowResult)
        {
            <form asp-action="Answer" method="post">
                @Html.AntiForgeryToken()
                @for (int i = 0; i < Model.Current.Choices.Count; i++)
                {
                    <div>
                        <label>
                            <input type="radio" name="choice" value="@i" required />
                            @Model.Current.Choices[i]
                        </label>
                    </div>
                }
                <button type="submit" class="btn btn-primary mt-3">Valider</button>
            </form>
        }
        else
        {
            if (Model.IsCorrect)
            {
                <p style="color:green;">Bonne réponse !</p>
            }
            else
            {
                <p style="color:red;">
                    Mauvaise réponse. La bonne réponse était :
                    @Model.Current.Choices[Model.Current.CorrectAnswer].
                </p>
            }
            <p><strong>Explication :</strong> @Model.Current.Explanation</p>

            <form asp-action="Next" method="post" class="d-inline">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-primary mt-3">Suivant</button>
            </form>
        }
    </div>
</div>